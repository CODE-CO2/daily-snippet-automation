- name: Send Daily Snippet
  env:
    DAILY_SNIPPET_API_URL: ${{ secrets.DAILY_SNIPPET_API_URL }}
    DAILY_SNIPPET_API_TOKEN: ${{ secrets.DAILY_SNIPPET_API_TOKEN }}
  run: |
    set -euo pipefail
    echo "URL=[$DAILY_SNIPPET_API_URL]"
    if [ -z "${DAILY_SNIPPET_API_URL:-}" ]; then echo "❌ URL empty"; exit 1; fi

    DATE=$(date -u +%FT%TZ)
    BODY=$(jq -nc \
      --arg email "jeh0224@gachon.ac.kr" \
      --arg content "자동 업로드 테스트" \
      --arg created "$DATE" \
      --arg title "smoke-$DATE" \
      '{author_email:$email,content:$content,created_at:$created,source:"github",title:$title}')

    curl -sS -X POST "$DAILY_SNIPPET_API_URL" \
      -H "Content-Type: application/json" \
      -H "Authorization: Bearer $DAILY_SNIPPET_API_TOKEN" \
      -H "apikey: $DAILY_SNIPPET_API_TOKEN" \
      --data "$BODY"
